!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Router=e()}(this,function(){function t(t,e,n,r){return t=t||{},t.timestamp=Date.now(),{state:t,title:e,url:n,type:r}}function e(t,e){e=e.replace(/\*/g,"([^/?#]+?)").replace(/\.\./,"(.*)");var n=new RegExp("^"+e+"$"),r=t.match(n);return r?r.slice(1):null}function n(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function r(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function i(t){for(var e=[],n=0,i=0,o="",s=N.exec(t);null!==s;){var u=s[0],a=s[1],h=s.index;if(o+=t.slice(i,h),i=h+u.length,a)o+=a[1];else{var c=t[i],p=s[2],f=s[3],l=s[4],y=s[5],d=s[6],g=s[7];o&&(e.push(o),o="");var v=null!==p&&null!==c&&c!==p,m="+"===d||"*"===d,b="?"===d||"*"===d,w=s[2]||"/",P=l||y||(g?".*":"[^"+w+"]+?");e.push({name:f||n++,prefix:p||"",delimiter:w,optional:b,repeat:m,partial:v,asterisk:!!g,pattern:r(P)}),s=N.exec(t)}}return i<t.length&&(o+=t.substr(i)),o&&e.push(o),e}function o(t,e){return t.keys=e,t}function s(t){return t.sensitive?"":"i"}function u(t,e){e=e||{};for(var r=e.strict,i=!1!==e.end,o="",u=t[t.length-1],a="string"==typeof u&&/\/$/.test(u),h=0;h<t.length;h++){var c=t[h];if("string"==typeof c)o+=n(c);else{var p=n(c.prefix),f="(?:"+c.pattern+")";c.repeat&&(f+="(?:"+p+f+")*"),f=c.optional?c.partial?p+"("+f+")?":"(?:"+p+"("+f+"))?":p+"("+f+")",o+=f}}if(!r){o=(a?o.slice(0,-2):o)+"(?:\\/(?=$))?"}return o+=i?"$":r&&a?"":"(?=\\/|$)",new RegExp("^"+o,s(e))}function a(t,e,n){for(var r=i(t),s=u(r,n),a=0;a<r.length;a++)"string"!=typeof r[a]&&e.push(r[a]);return o(s,e)}function h(t,e,n){return e=e||[],Array.isArray(e)?n||(n={}):(n=e,e=[]),a(t,e,n)}function c(t,e){var n=h(e),r=n.exec(t);return r&&(r=r.slice(1)),r}function p(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=void 0;return function(){clearTimeout(r),r=setTimeout(e.bind(t),n)}}function f(t){var e=this.history;if(t instanceof Event){var n=T.state,r=e.indexOfState(n);if(-1!==r){var i=e.length-e.index-1-r;e.go(i)}else{var o=this.getPathFromBase(),s=e.pushState(null,document.title,o);T.replaceState(s,document.title,this.resolve(o))}}else if(!T.state||T.state.timestamp!==e.current.state.timestamp){var u=this.resolve(t.url);"push"===t.type?T.pushState(t.state,t.title,u):T.replaceState(t.state,t.title,u)}}function l(){var t=this.history.current,e=this.resolve(t.url);T.replaceState(t.state,t.title,e),this._onPopState=f.bind(this),this.history.on("popstate",this._onPopState),window.addEventListener("popstate",this._onPopState)}function y(){this._onPopState&&(this.history.off("popstate",this._onPopState),window.removeEventListener("popstate",this._onPopState),delete this._onPopState,delete this._onHashChange)}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},v=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),m=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},b=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},w=new WeakMap,P=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){function t(){g(this,t)}return t}();return function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),e.prototype.on=function(t,e,n){if("string"==typeof t&&"function"==typeof e&&(n=e,e=t,t=this),"function"!=typeof n)throw new Error("Callback is not a function.");var r=w.get(t)||{},i=r[e]=r[e]||{length:0},o=i.length;return i[o]={fn:n,destroy:function(t,e,n){return function(){void 0!==t[e][n]&&delete t[e][n]}}(r,e,o)},i.length+=1,w.set(t,r),r[e][o].destroy},e.prototype.off=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"string"!=typeof t&&void 0!==t||(e=t,t=this);var n=w.get(t);if(n)if(e){var r=n[e];for(var i in r)"object"===d(r[i])&&"function"==typeof r[i].destroy&&r[i].destroy.call(t)}else for(var o in n)n.hasOwnProperty(o)&&this.off(t,o)},e.prototype.trigger=function(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];"string"==typeof t&&(r.unshift(e),e=t,t=this);var o=w.get(t)||{},s=o[e]||{},u=[];for(var a in s)if(s.hasOwnProperty(a)){var h=s[a];"object"===(void 0===h?"undefined":d(h))&&"function"==typeof h.fn&&u.push(h.fn.apply(t,r))}return Promise.all(u)},e}(t)},x=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,null,[{key:"mixin",get:function(){return P}}]),e}(P());Object.setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t};var E=function(){function t(e,n){g(this,t);for(var r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var s=new(Function.prototype.bind.apply(Error,[null].concat([e],i)));return void 0===e?s.message=this.defaultMessage:e instanceof Error&&(n=e,s.message=this.defaultMessage),n&&(s.originalError=n,s.message=s.message+", from "+n.name+": "+n.message+"."),s.name=this.constructor.exceptionName,Object.setPrototypeOf(s,this.constructor.prototype),s}return v(t,[{key:"defaultMessage",get:function(){return"Generic Router error"}},{key:"exceptionName",get:function(){return"RouterException"}}]),t}(),S=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,[{key:"defaultMessage",get:function(){return"Out of history navigation."}},{key:"exceptionName",get:function(){return"OutOfHistoryException"}}]),e}(E),k=function(e){function n(){g(this,n);var t=b(this,e.call(this));return t.reset(),t}return m(n,e),n.prototype.reset=function(){this.index=-1,this.entries=[]},n.prototype.go=function(t){if(0!==t){var e=this.index+t;if(e<0||e>=this.entries.length)return Promise.reject(new S);this.index=e,this.trigger("popstate",this.current)}return Promise.resolve(this.current)},n.prototype.back=function(){return this.go(-1)},n.prototype.forward=function(){return this.go(1)},n.prototype.indexOfState=function(t){t=t||{};for(var e=this.entries.slice(0).reverse(),n=0,r=e.length;n<r;n++)if(e[n].state.timestamp===t.timestamp)return n;return-1},n.prototype.pushState=function(e,n,r){var i=t(e,n,r,"push");return this.entries=this.entries.slice(0,this.index+1),this.entries.push(i),this.go(1),this.trigger("popstate",i),i},n.prototype.replaceState=function(e,n,r){var i=t(e,n,r,"replace");return this.entries[this.index]=i,i},v(n,[{key:"current",get:function(){return this.entries[this.index]}},{key:"length",get:function(){return this.entries.length}}]),n}(x.mixin()),R=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,[{key:"defaultMessage",get:function(){return"Router has not been started yet."}},{key:"exceptionName",get:function(){return"RouterNotStartedException"}}]),e}(E),j=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,[{key:"defaultMessage",get:function(){return"Router rule has not been found."}},{key:"exceptionName",get:function(){return"RouterNotFoundException"}}]),e}(E),O=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,[{key:"defaultMessage",get:function(){return"Router state does not exist."}},{key:"exceptionName",get:function(){return"RouterInvalidException"}}]),e}(E),_=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,[{key:"defaultMessage",get:function(){return"Route callback handling rejected."}},{key:"exceptionName",get:function(){return"RouterUnhandledException"}}]),e}(E),F=function(t){function e(){return g(this,e),b(this,t.apply(this,arguments))}return m(e,t),v(e,[{key:"defaultMessage",get:function(){return"Parser for router instance is undefined."}},{key:"exceptionName",get:function(){return"ParserUndefinedException"}}]),e}(E),N=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),A="undefined"!=typeof window&&"function"==typeof window.addEventListener,T=A&&window.history,$=A&&(T&&T.location||window&&window.location),M=0,U=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g(this,t),this.history=new k,this.started=!1,this.reset(),this.options={};for(var n in this.DEFAULTS)e.hasOwnProperty(n)?this.options[n]=e[n]:this.DEFAULTS.hasOwnProperty(n)&&(this.options[n]=this.DEFAULTS[n]);this.parser=this.options.parser,this.base=this.options.base,this.id=M,M++}return v(t,[{key:"DEFAULTS",get:function(){return{base:"#",dispatch:!0,bind:!0,parser:t.defaultParser,triggerHashChange:!0}}}],[{key:"EXPRESS_PARSER",get:function(){return c}},{key:"RIOT_PARSER",get:function(){return e}},{key:"defaultParser",get:function(){return this.EXPRESS_PARSER}}]),t.prototype.reset=function(){this.callbacks={},this.routes=[]},t.prototype.getPathFromBase=function(e){var n=this.base;return n&&"#"===n[0]?(e=e||$.href||"",e.split(n)[1]||""):(e=$?t.getPathFromRoot(e):e||"",this.normalize(e.replace(n,"")))},t.prototype.hasPathnameChanged=function(t){return"string"!=typeof this.current||this.current.split("#").shift()!==t.split("#").shift()},t.prototype.changeType=function(t){return t!==this.current?this.hasPathnameChanged(t)?2:1:0},t.prototype.trigger=function(t){var e=this,n=this.history&&this.history.current&&this.history.current.url||"",r=this.changeType(n);if(t||r>0&&(this.options.triggerHashChange||2===r)){if(this.current=n,"function"!=typeof this.parser)return Promise.reject(new F);var i=Promise.reject(new _);return this.routes.some(function(t){var r=e.parser(e.normalize(n),e.normalize(t));if(null!==r){return(e.callbacks[t]||[]).forEach(function(t){i=i.catch(function(n){return n&&n instanceof _?t.apply(e,r):Promise.reject(n)})}),!0}return!1}),i.catch(function(t){return Promise.reject(t||new j)})}if(1===r&&this.options.bind){this.current=n;var o=new Event("hashchange");window.dispatchEvent(o)}return Promise.resolve()},t.prototype.on=function(t,e){t=this.normalize(t),t="/"+t,this.routes.push(t),this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push(e)},t.prototype.navigate=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.started?(t=this.normalize(t),n?this.history.replaceState(null,e,t):this.history.pushState(null,e,t),this.trigger(r)):Promise.reject(new R)},t.prototype.refresh=function(){if(this.started){var t=this.history&&this.history.current&&this.history.current;return t?this.navigate(t.url,t.title,!0,!0):Promise.reject(new O)}return Promise.reject(new R)},t.prototype.back=function(){return this.started?this.history.back():Promise.reject(new R)},t.prototype.forward=function(){return this.started?this.history.forward():Promise.reject(new R)},t.prototype.start=function(){if(!this.started){var t=Promise.resolve();return this.options.bind&&(this.current=this.getPathFromBase(),this.history.pushState(null,document.title,this.current)),this.started=!0,A&&(this.debouncedEmit=p(this,this.trigger,1).bind(this),this.history.on("popstate",this.debouncedEmit),this.options.dispatch&&this.history.length&&(t=this.trigger(!0)),this.options.bind&&l.call(this),this.options.dispatch=!0),t}return Promise.reject()},t.prototype.stop=function(){this.started&&(this.history.reset(),this.history.off("popstate",this.debouncedEmit),this.reset(),y.call(this),this.started=!1)},t.prototype.normalize=function(t){return t.replace(/^\/|\/$/,"")},t.prototype.resolve=function(t){t=t.replace(/^\/*/,"");var e="/"!==this.base.slice(-1);return this.base+(e?"/":"")+t},t.prototype.query=function(t){var e={};return t=t||this.current||this.getPathFromBase(),t.replace(/[?&](.+?)=([^&]*)/g,function(t,n,r){e[n]=r}),e},t.getPathFromRoot=function(t){return t=t||$.href,t.replace(/^((https?|s?ftps?):\/+)?(.+?)(?=\/|$)/i,"")},t}();return U.RouterNotStartedException=R,U.RouterNotFoundException=j,U.RouterInvalidException=O,U.RouterUnhandledException=_,U.ParserUndefinedException=F,U.OutOfHistoryException=S,U});

//# sourceMappingURL=router.js.map
